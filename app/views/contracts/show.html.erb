<p id="notice"><%= notice %></p>

<p>
  <strong>Book:</strong>
  <%= link_to Book.find(Post.find(@contract.post_id).book_id).title, Post.find(@contract.post_id) %>
</p>

<p>
  <strong>Seller:</strong>
  <%= User.find(@contract.seller_id).name %>
</p>

<p>
  <strong>Buyer:</strong>
  <%= User.find(@contract.buyer_id).name %>
</p>

<p>
  <strong>Meeting time:</strong>
  <%= @contract.meeting_time.strftime("%Y-%m-%d %H:%M") %>
</p>

<p>
  <strong>Meeting address:</strong>
  <br/><%= @contract.meeting_address_first %>
  <br/><%= @contract.meeting_address_second %>
</p>

<p>
  <strong>Final method:</strong>
  <%= @contract.final_payment_method %>
</p>

<p>
  <strong>Final price:</strong>
  $<%= @contract.final_price %>
</p>

<p>
  <strong>Expiration time:</strong>
  <%= @contract.expiration_time.strftime("%Y-%m-%d %H:%M") %>
</p>

<p>
  <strong>Status:</strong>
  <%= @contract.status %>
  <% if @contract.status == "waiting"%>
    for <%= User.find(@contract.unsigned_user_id).name %>
  <% end %>
</p>

<br/>

<% if current_user.has_roles?(:site_admin) || @contract.buyer_id == current_user.id || @contract.seller_id == current_user.id%>
  <% if current_user.has_roles?(:site_admin)%>
    <div> <%= link_to 'Edit', edit_contract_path(@contract, admin: true)%> </div>
    <div> <%= link_to 'Delete', @contract, method: :delete, data: { confirm: 'Are you sure you want to delete?' } %> </div>
  <% elsif @contract.status == "waiting" && @contract.unsigned_user_id != current_user.id %>
    <div> <%= link_to 'Edit', edit_contract_path(@contract) %> </div>
    <div> <%= link_to 'Delete', @contract, method: :delete, data: { confirm: 'Are you sure you want to delete?' } %> </div>
  <% end %>

  <% if @contract.status == "waiting" && @contract.unsigned_user_id == current_user.id %>
    <div> <%= link_to "Confirm", contract_path(@contract, contract: {status: :confirmed, unsigned_user_id: nil}), :method => :put, data: { confirm: 'Are you sure you want to confirm?' } %> </div>
    <div> <%= link_to "Decline", contract_path(@contract, contract: {status: :declined, unsigned_user_id: nil}), :method => :put, data: { confirm: 'Are you sure you want to decline?' } %> </div>
  <% end %>
<% end %>
<%= link_to 'Back', contracts_path %>
