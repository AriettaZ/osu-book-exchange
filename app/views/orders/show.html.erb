<p id="notice"><%= notice %></p>
<% contract = Contract.find(@order.contract_id)%>
<% post = Post.find(contract.post_id)%>
<% book = Book.find(post.book_id)%>

<h1>Order #<%=@order.id %> </h1>
<%= image_tag book.cover_image unless book.cover_image.nil? %>
<p>
  <strong>Course Number:</strong>
  <%= post.course_number %>
</p>

<p>
  <strong>Book Title:</strong>
  <%= book.title %>
</p>

<p>
  <strong>Edition:</strong>
  <%= book.edition %>
</p>

<% if !book.ISBN_10.nil? %>
<p>
  <strong>ISBN_10:</strong>
  <%= book.ISBN_10 %>
</p>
<% end %>

<% if !book.ISBN_13.nil? %>
<p>
  <strong>ISBN_13:</strong>
  <%= book.ISBN_13 %>
</p>
<% end %>

<p>
  <strong>Book Condition:</strong>
  <%= post.condition %>
</p>

<p>
  <strong>Book Description:</strong>
  <%= post.description %>
</p>

<p>
  <strong>Seller:</strong>
  <%= User.find(contract.seller_id).name %>
</p>

<p>
  <strong>Buyer:</strong>
  <%= User.find(contract.buyer_id).name %>
</p>

<p>
  <strong>Meeting time:</strong>
  <%= contract.meeting_time.strftime("%Y-%d-%m %H:%M:%S") %>
</p>

<p>
  <strong>Meeting address:</strong>
  <br/><%= contract.meeting_address_first %>
  <br/><%= contract.meeting_address_second %>
</p>

<p>
  <strong>Payment method:</strong>
  <%= contract.final_payment_method %>
</p>

<p>
  <strong>Price: </strong>
  $<%= contract.final_price %>
</p>

<p>
  <strong>Order Status:</strong>
  <%= @order.status %>
</p>

<p>
  <strong>Order Created At:</strong>
  <%= @order.created_at.strftime("%Y-%d-%m %H:%M:%S") %>
</p>


<% if @order.status != "closed" && @order.status != "canceled" %>
  <% if current_user.id == contract.buyer_id %>
    <div> <%= link_to "Cancel the Order", order_path(@order, order: {status: :canceled}), :method => :put, data: { confirm: 'Are you sure to cancel this order?' } %> </div>
    <div> <%= link_to "Order Completed", order_path(@order, order: {status: :closed}), :method => :put, data: { confirm: 'Are you sure?' } %> </div>
  <% end %>
<% elsif current_user.id == contract.buyer_id || current_user.id == contract.seller_id %>
    <div> <%= link_to "Report Problems", order_path(@order, order: {status: :problematic}), :method => :put, data: { confirm: 'Are you sure?' } %> </div>
<% end %>

<% if current_user.has_roles?(:site_admin)%>
  <%= link_to 'Edit', edit_order_path(@order) %>
<% end %>
<%= link_to 'Back', orders_path %>
